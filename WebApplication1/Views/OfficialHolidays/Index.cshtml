@model List<PublicHoliday>

<style>
    .border {
        border: 1px solid #ddd;
        border-radius: 5px;
    }

    .form-label {
        font-weight: bold;
    }

    .btn {
        margin: 5px;
    }
</style>
@Html.AntiForgeryToken()

    <div class="container mt-4 bg-light">
        <div class="card">
            <div class="card-header text-center fw-bold">Official Holidays</div>
            <div class="card-body">

                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Date</label>
                        <input type="date" id="holidayDate" class="form-control" placeholder="Select a date">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Name</label>
                        <input type="text" id="holidayName" class="form-control" placeholder="Enter holiday name">
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        @* <button class="btn btn-success w-100" onclick="addHoliday()">Add</button> *@
                    <a href="#" onclick="addHoliday()" class="btn btn-success w-100">Add</a>
                    </div>
                </div>

                <table class="table table-bordered text-center">
                    <thead class="table-secondary">
                        <tr>
                            <th>Operations</th>
                            <th>Date</th>
                            <th>Name</th>
                        </tr>
                    </thead>
                    <tbody id="holidayTable">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                <button class="btn btn-sm btn-outline-primary"><i class="fa-regular fa-pen-to-square"></i></button>
                                <a href="#" onclick="areYouSure('@item.Id')" class="btn btn-danger">Delete</a>
                            </td>
                            <td>
                                @item.Date <span>@item.Date.ToString("dddd")</span>
                            </td>
                            <td>
                                @item.Name
                            </td>
                        </tr>
                    }
                           
                    </tbody>
                </table>
            </div>
        </div>
    </div>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script>
    $.ajaxSetup({
        headers: {
            'RequestVerificationToken': $('input:hidden[name="__RequestVerificationToken"]').val()
        }
    });
        function addHoliday() {
        var date = $("#holidayDate").val();
        var name = $("#holidayName").val();

        if (!date || !name) {
            Swal.fire({
                title: "Error!",
                text: "Please provide both date and name.",
                icon: "error"
            });
            return;
        }

        var newHoliday = {
            Date: date,
            Name: name,
            GeneralSettingsId:1

        };

        $.ajax({
            url: "/OfficialHolidays/AddPublicHoliday",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(newHoliday),
            success: function(response) {
                Swal.fire({
                    title: "Added!",
                    text: "Holiday has been added.",
                    icon: "success"
                }).then(() => {
                    var newRow = `<tr>
                        <td>
                            <button class="btn btn-sm btn-outline-primary"><i class="fa-regular fa-pen-to-square"></i></button>
                            <a href="#" onclick="areYouSure('${response.id}')" class="btn btn-danger">Delete</a>
                        </td>
                        <td>
                            ${response.date} <span>${new Date(response.date).toLocaleString('en-US', { weekday: 'long' })}</span>
                        </td>
                        <td>
                            ${response.name}
                        </td>
                    </tr>`;
                    $("#holidayTable").append(newRow);
                    $("#holidayDate").val('');
                    $("#holidayName").val('');
                });
            },
            error: function(xhr, status, error) {
                console.error("AJAX request failed:", status, error);
                Swal.fire({
                    title: "Error!",
                    text: "There was an error adding the holiday.",
                    icon: "error"
                });
            }
        });
    }



    function areYouSure(id) {
        console.log("Delete ID: ", id);
        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: "/OfficialHolidays/Delete/" + id,
                    type: "DELETE",
                    success: function(response) {
                        console.log("Response: ", response);
                        Swal.fire({
                            title: "Deleted!",
                            text: "Your file has been deleted.",
                            icon: "success"
                        }).then(() => {
                            location.href="/OfficialHolidays/Index";
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error("AJAX request failed:", status, error);
                        Swal.fire({
                            title: "Error!",
                            text: "There was an error deleting your file.",
                            icon: "error"
                        });
                    }
                });
            }
        });
    }


</script>
